<div class="flex rounded w-screen h-screen items-center justify-center bg-opacity-20 bg-font-grey flex-col fixed top-0 z-50 "
    #formContainer>

    <form class="aspect-square max-w-screen-md w-full h-fit max-h-[90vh]" [formGroup]="postForm"
        (submit)="createPost($event, description)"
        #form>
        <div class="flex h-fit max-h-[90vh] overflow-y-scroll overflow-x-hidden flex-col relative items-center p-5 rounded-lg bg-main-white border-[4px] border-transparent gap-10 shadow-2xl px-20"
            #formContent>
            <button (click)="toggleForm()"
                class="absolute top-1 right-1 text-secondary border-2 border-secondary transition hover:text-main-white hover:bg-secondary rounded hover:scale-125 p-1 flex items-center justify-center">
                <span class="material-icons">close</span>
            </button>
            <div class="flex flex-col w-full gap-2 items-start justify-center ">
                <input placeholder=" " #title id="title" type="text" formControlName="name"
                    class="border-b-2 border-main peer bg-transparent order-2 p-2 w-full cursor-text" />
                <label
                    class="w-full font-medium translate-x-0 text-main translate-y-0 order-1 peer-placeholder-shown:translate-y-10 peer-placeholder-shown:translate-x-2 peer-placeholder-shown:text-font-grey transition ease-in-out cursor-text select-none"
                    for="title">Titulo</label>
                <app-validation-error class="order-3 w-full" [form]="postForm" [errors]="['required']"
                    [field]="'name'"></app-validation-error>
            </div>
            <div class="flex flex-col gap-2 items-start justify-center w-full">
                <label class="font-medium text-main" for="description">Descripción</label>
                <textarea #description class="border-2 border-main shadow rounded-lg p-2 h-full w-full "
                    name="description" required id="description" rows="10"
                    placeholder="Escribe en contenido de texto de el post"></textarea>
            </div>
            <div class="w-full flex flex-col">
                <div class="flex items-baseline w-full gap-4">
                    <label class="font-medium text-main" for="group_id">Grupo del post</label>
                    <select  #select  class="border-main border-2 rounded-md" formControlName="group_id" id="group_id" autocomplete="off">
                        <option #default [attr.selected]="true" disabled hidden value="">Escoje grupo</option>
                        @for (group of groups() ; track $index){
                        <option value="{{group.id}}">{{group.name}}</option>
                        }
                        <option value="">Publico</option>
                        
                    </select>
                </div>
                <app-validation-error class="" [form]="postForm" [errors]="['required']"
                    field="group_id" [showError]="showError()"></app-validation-error>
            </div>
            <!-- Resources -->
            <div class="w-full flex flex-col items-center h-fit">
                <!-- Buttons-->
                <div class="w-full flex items-center justify-center h-fit p-2 gap-4">
                    <button type="button" (click)="addLink()">
                        <div #openLink
                            class="border-2 p-2 text-secondary w-fit rounded-lg flex items-center border-secondary gap-2 transition-all">
                            <span class="material-icons flex items-center justify-center w-fit">link</span>
                            <span> | Add a new link</span>
                        </div>
                        <div #closeLink
                            class="flex border-2 p-2 w-fit rounded-lg items-center border-secondary gap-2 text-main-white bg-secondary hidden transition-all">
                            <span class="material-icons">close</span>
                            <span>Close the form</span>
                        </div>
                    </button>
                    <button type="button" class=" group" (click)="file.click()">
                        <div #openLink
                            class="border-2 p-2 text-main group-hover:bg-main group-hover:scale-110 group-hover:text-main-white w-fit rounded-lg flex items-center border-main gap-2 transition-all">
                            <span class="material-icons flex items-center justify-center w-fit">attach_file</span>
                            <span> | Add a new file</span>
                        </div>
                        <input #file type="file" class="hidden" (change)="addFile($event)">
                    </button>
                </div>
                <!-- Links -->
                <div class="w-full overflow-hidden  h-fit">
                    <div #linkMenu class="flex w-[200%] transition-all ease-out h-fit">
                        <div #lists class="w-1/2 h-fit flex items-start gap-4">
                            <div #linkList class="w-1/2 flex flex-col gap-4 h-fit ">
                                <div class="w-full pb-2 border-b-2 border-main">
                                    <span class="text-2xl font-medium text-main ">Links</span>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    @for (link of links(); track $index) {
                                    <div
                                        class="w-fit p-2 rounded-lg border-2 border-main flex items-center justify-between">
                                        <a class="mx-auto" target="_blank" href="{{ link.link }}">
                                            {{ link.link_name }}
                                        </a>
                                        <button type="button" (click)="deleteLink(link)" class="hover:text-red-500 transition flex items-center justify-center ">
                                            <span class="material-icons">close</span>
                                        </button>
                                    </div>
                                    }
                                </div>
                            </div>
                            <div class="flex flex-col w-1/2 gap-4 min-h-[2rem]" #fileList>
                                <div class=" w-full pb-2 border-b-2 border-secondary">
                                    <span class="text-2xl font-medium text-secondary ">Files</span>
                                </div>
                                <div class=" flex flex-col flex-wrap gap-2">
                                    @for (file of files(); track $index) {
                                        <div
                                        class="w-fit p-2 rounded-lg border-2 border-secondary flex items-center justify-between">
                                        <a class="mx-auto" download [href]="download(file)" >
                                            {{ file.name }}
                                        </a>
                                        <button type="button" (click)="deleteFile(file)"  class="hover:text-red-500 transition flex items-center justify-center ">
                                            <span class="material-icons">close</span>
                                        </button>
                                    </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="w-1/2 h-fit flex">
                            <form [formGroup]="linkForm" #formLink
                                class="w-full flex flex-col gap-1 p-4 transition-all ease-in-out h-10"
                                (submit)="createLink()">
                                <div class="flex flex-col w-full select-none gap-3 items-start justify-center pt-2">
                                    <input formControlName="link_name" type="text" id="linkTitle"
                                        class="border-b-2 w-full order-2 bg-transparent border-main peer"
                                        placeholder=" " />
                                    <label
                                        class="order-1 translate-x-0 translate-y-0 font-medium text-main peer-placeholder-shown:translate-y-8 peer-placeholder-shown:translate-x-2 peer-placeholder-shown:text-font-grey transition-all ease-in-out"
                                        for="linkTitle">Nombre del link</label>
                                    <app-validation-error class="order-3" [form]="linkForm" [errors]="['required']"
                                        field="link_name"></app-validation-error>
                                </div>
                                <div class="flex flex-col w-full select-none gap-3 items-start justify-center pt-2">
                                    <input formControlName="link" type="url" id="link"
                                        class="border-b-2 w-full order-2 bg-transparent border-main peer"
                                        placeholder=" " />
                                    <label
                                        class="order-1 translate-x-0 translate-y-0 font-medium text-main peer-placeholder-shown:translate-y-8 peer-placeholder-shown:translate-x-2 peer-placeholder-shown:text-font-grey transition-all ease-in-out"
                                        for="link">Url del link</label>
                                    <app-validation-error class="order-3" [form]="linkForm" [errors]="['required']"
                                        field="link"></app-validation-error>
                                </div>
                                <button [disabled]="linkForm.invalid" type="submit"
                                    class="border-2 cursor-pointer border-secondary text-secondary hover:text-main-white hover:bg-secondary rounded-md p-1 hover:scale-105  transition">
                                    Añadir link
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <button
                class="{{postForm.invalid ? 'cursor-not-allowed' : 'cursor-pointer hover:bg-main hover:text-main-white hover:scale-105'}} px-4 py-2 border-[3px] rounded-lg border-main text-main font-bold bg-transparent  transition "
                #submitButton type="submit"
                [disabled]="postForm.invalid"
                (click)="tryPostPost()">
                Crear post
            </button>
        </div>

    </form>
</div>