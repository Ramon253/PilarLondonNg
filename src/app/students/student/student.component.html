<section class="w-full bg-main-grey min-h-[90vh] mt-[10vh] h-fit">
    <div class="max-w-screen-xl mx-auto flex flex-col pt-10">
        @if (isLoading()) {
            <div class="w-full flex items-center justify-center">
                <div class="h-96 rounded-full bg-gray-300 animate-pulse w-96"></div>
            </div>
        } @else {
            <div class="w-full flex flex-col gap-5 items-center justify-center pb-20">
                <div class="aspect-square h-96  relative group">
                    <img src="{{environment.baseUrl}}api/user/{{student().user_id}}/profile-picture"
                         alt="Profile_picture"
                         class="rounded-full h-full shadow"
                    >
                    <span
                        class="absolute top-0 right-0 text-main hover:text-main-white group-hover:text-main-white cursor-pointer material-icons flex items-center p-1 rounded-full hover:bg-main group-hover:bg-main transition">
                        edit
                    </span>
                </div>

                <div
                    class="max-w-screen-lg  w-screen mx-auto  text-main pt-4 border-b-2 border-dark-font flex flex-col gap-2">
                    <h1 class="w-full text-secondary font-bold text-5xl text-center">{{ user().name }}</h1>
                    <div class="w-full flex text-xl font-medium text-dark-font">
                        <div (click)="show().data= true; show().data = true;"
                             class="border-b px-6 font-medium cursor-pointer transition relative">
                            Datos
                            <div
                                class="absolute -bottom-[3px] left-0 h-[3px] transition ease-in-out bg-secondary w-full shadow {{getTab()}}">
                            </div>
                        </div>
                        <div (click)="resetShow(); show().groups = true"
                             class=" px-6 font-medium cursor-pointer transition ">
                            Grupos
                        </div>
                        <div (click)=" resetShow(); show().solutions = true;"
                             class=" px-6 font-medium cursor-pointer transition ">
                            Tareas
                        </div>

                    </div>
                </div>
                @if (show().data) {
                    <div class="max-w-screen-lg mx-auto p-2 rounded-lg bg-main-white shadow w-screen h-fit ">
                        <div
                            class="w-full p-2 border-b-2 border-main text-center text-xl    font-bold text-main max-w-screen-md mx-auto">
                            <span class="w-full text-center">Perfil</span>
                        </div>
                        <div class="flex gap-2 max-w-screen-md w-screen text-xl mx-auto">
                            <div class="flex flex-col gap-8 p-10 basis-1/2">
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-main">Full name :</span>
                                    <span>{{ student().full_name }}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-main">Surname :</span>
                                    <span>{{ student().surname }}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-main">Email :</span> <span>{{ user().email }}</span>
                                </div>
                            </div>
                            <div class=" flex flex-col gap-8 p-10">
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-main">Phone number</span>
                                    <span>{{ student().phone_number }}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-main">Level :</span> <span>{{ student().level }}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-main">Age :</span> <span>{{ student().age }}</span>
                                </div>
                            </div>

                        </div>
                        <div
                            class="w-full p-2 border-b-2 border-main text-center text-xl    font-bold text-main max-w-screen-md mx-auto">
                            <span class="w-full text-center">Notas</span>
                        </div>
                        <div class="max-w-screen-md mx-auto flex flex-col p-10">
                            <div class="w-full grid grid-rows-2 grid-cols-2 gap-10 gap-x-20 text">
                                <div class="text-xl font-medium flex items-center gap-2">
                                    <span class="text-main font-bold">Tareas enviadas : </span>
                                    <span>{{ submissions().length }}</span>
                                </div>
                                <div class="text-xl font-medium flex items-center gap-2 ">
                                    <span class="text-main font-bold"> Nota media : </span>
                                    <span>{{ getAvgNote() }}</span>
                                </div>
                                <div class="text-xl font-medium flex items-center gap-2">
                                    <span class="text-main font-bold">Tareas por calificar</span>
                                    <span>{{ this.unmarkedSolutions }}</span>
                                </div>
                                <div class="text-xl font-medium flex items-center gap-2">
                                    <span class="text-main font-bold">Tareas por calificadas</span>
                                    <span>{{ this.submissions().length }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                } @else if (show().groups) {
                    <div class="max-w-screen-lg w-screen flex flex-col gap-5">
                        @for (group of groups(); track $index) {
                            <app-group-card [group]="group"></app-group-card>
                        }
                    </div>
                } @else if (show().solutions) {
                    <div class="max-w-screen-lg w-screen grid grid-cols-2 flex-col gap-5 p-3">
                        @for (solution of submissions(); track $index) {
                            <div routerLink="/assignment/{{solution.assignment_id}}" class="w-full border-2 border-transparent hover:border-main hover:scale-105 hover:shadow-button-hover text-md justify-between rounded-lg bg-main-white relative shadow flex h-28 p-10 gap-5 items-center transition-all duration-200 ease-in-out cursor-pointer">
                                <span class="text-xl text-main font-bold">
                                    <a routerLink="/group/{{solution.group_id}}">{{ solution.group_name }}</a> / <a routerLink="/assignment/{{solution.assignment_id}}" class="font-medium">{{ solution.assignment_name }}</a>
                                </span>
                                @if(solution.note === null){
                                    <span
                                        class="text-xl text-font-grey font-medium">Sin calificar</span>
                                }@else{
                                    <span
                                        class="text-xl text-font-grey font-medium">Nota <span
                                        class="{{parseInt(solution.note ?? '') >=5 ? 'text-green-500':'text-secondary'}}">{{ solution.note }}</span>/10</span>
                                }

                                <span
                                    class="absolute top-2 text-md left-2 text-secondary-grey">{{ datePipe.transform(solution.updated_at, 'HH:mm dd/MM/yyyy') }}</span>
                            </div>
                        }
                    </div>
                }
            </div>
        }
    </div>
</section>
